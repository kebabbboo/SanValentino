<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Lilian ‚ù§Ô∏è</title>

<style>
  * { box-sizing: border-box; }

  body {
    margin: 0;
    height: 100vh;
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #ff9a9e, #fad0c4);
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: auto;
  }

  .card {
    background: #fff;
    padding: 22px;
    border-radius: 20px;
    width: 92%;
    max-width: 390px;
    text-align: center;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    position: relative;

    /* ‚úÖ scroll interno */
    max-height: 80vh;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
  }

  h1 { color: #ff4d6d; margin: 6px 0 10px; }
  p  { font-size: 17px; color: #333; margin: 10px 0; line-height: 1.35; }

  .buttons {
    margin-top: 18px;
    height: 120px;
    position: relative;
  }

  button {
    padding: 13px 22px;
    border: none;
    border-radius: 28px;
    font-size: 16px;
    cursor: pointer;
  }

  #yesBtn {
    background: #ff4d6d;
    color: white;
    position: absolute;
    left: 50%;
    top: 0;
    transform: translateX(-50%);
  }

  #noBtn {
    background: #e6e6e6;
    color: #555;
    position: absolute;
    left: 50%;
    top: 62px;
    transform: translateX(-50%);
    touch-action: manipulation;
  }

  .pill {
    display: inline-block;
    padding: 8px 12px;
    border-radius: 999px;
    background: #fff0f3;
    color: #b21e35;
    font-size: 14px;
    margin-top: 10px;
  }

  .hidden { display: none; }

  /* Finale */
  #final {
    margin-top: 14px;
    border-top: 1px solid #f0f0f0;
    padding-top: 14px;
  }

  .photo {
    width: 100%;
    max-height: 220px;
    object-fit: cover;
    border-radius: 16px;
    margin: 10px 0 6px;
    box-shadow: 0 8px 18px rgba(0,0,0,0.12);
    animation: photoIn 500ms ease both;
  }

  @keyframes photoIn {
    from { opacity: 0; transform: scale(0.96); }
    to   { opacity: 1; transform: scale(1); }
  }

  .grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 10px;
    margin-top: 12px;
    text-align: left;
  }

  .panel {
    background: #fff7f9;
    border: 1px solid #ffd2dc;
    border-radius: 16px;
    padding: 12px;
    position: relative;
    overflow: hidden; /* utile per confetti in panel */
  }

  .panel h3 {
    margin: 0 0 8px;
    font-size: 15px;
    color: #b21e35;
    text-align: center;
  }

  .choices {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: center;
  }

  .choiceBtn {
    background: #ffffff;
    border: 1px solid #ffb3c1;
    color: #b21e35;
    padding: 10px 14px;
    border-radius: 999px;
    font-size: 14px;
  }

  .choiceBtn:active { transform: scale(0.98); }

  .result {
    margin-top: 8px;
    font-size: 15px;
    color: #333;
    text-align: center;
  }

  .sliderWrap {
    display: grid;
    gap: 8px;
    justify-items: center;
  }

  /* ---- MISURATORE: barra che si RIEMPIE + thumb "fuoco" elegante ---- */
  #loveRange{
    width: 100%;
    accent-color: #ff4d6d; /* fallback */
    -webkit-appearance: none;
    appearance: none;
    height: 10px;
    border-radius: 999px;
    outline: none;
    background: linear-gradient(90deg, #ff4d6d 50%, rgba(255, 77, 109, 0.22) 50%);
  }

  #loveRange::-webkit-slider-runnable-track{
    height: 10px;
    border-radius: 999px;
    background: transparent;
  }
  #loveRange::-moz-range-track{
    height: 10px;
    border-radius: 999px;
    background: transparent;
  }

  #loveRange::-webkit-slider-thumb{
    -webkit-appearance: none;
    appearance: none;
    width: 30px;
    height: 30px;
    border-radius: 999px;
    border: 2px solid rgba(255,255,255,0.95);
    cursor: pointer;
    margin-top: -10px;
    background:
      radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9) 0 18%, rgba(255,255,255,0) 19% 100%),
      radial-gradient(circle at 55% 65%, rgba(255, 190, 90, 0.95) 0 35%, rgba(255, 110, 70, 0.95) 55%, rgba(255, 77, 109, 1) 100%);
    box-shadow:
      0 10px 18px rgba(255, 77, 109, 0.25),
      0 0 16px rgba(255, 110, 70, 0.55);
  }
  #loveRange:active::-webkit-slider-thumb { transform: scale(1.06); }

  #loveRange::-moz-range-thumb{
    width: 30px;
    height: 30px;
    border-radius: 999px;
    border: 2px solid rgba(255,255,255,0.95);
    cursor: pointer;
    background:
      radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9) 0 18%, rgba(255,255,255,0) 19% 100%),
      radial-gradient(circle at 55% 65%, rgba(255, 190, 90, 0.95) 0 35%, rgba(255, 110, 70, 0.95) 55%, rgba(255, 77, 109, 1) 100%);
    box-shadow:
      0 10px 18px rgba(255, 77, 109, 0.25),
      0 0 16px rgba(255, 110, 70, 0.55);
  }
  #loveRange:active::-moz-range-thumb { transform: scale(1.06); }

  /* ---- GRATTA E SCOPRI ---- */
  .scratchWrap {
    position: relative;
    border-radius: 16px;
    overflow: hidden;
    border: 1px solid #ffb3c1;
    background: #ffffff;
  }

  .scratchPrize {
    padding: 14px 14px 16px;
    text-align: center;
  }

  .scratchPrize .big {
    font-size: 18px;
    color: #b21e35;
    font-weight: 700;
    margin-bottom: 6px;
  }

  .scratchPrize .small {
    font-size: 14px;
    color: #333;
    opacity: 0.9;
  }

  canvas#scratchCanvas {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    touch-action: none;
    cursor: grab;
  }

  .scratchHint {
    margin-top: 8px;
    font-size: 13px;
    color: #7a1c2c;
    text-align: center;
    opacity: 0.9;
  }

  /* Cuori */
  .heart {
    position: fixed;
    bottom: -30px;
    animation: floatUp 4.2s linear forwards;
    pointer-events: none;
    filter: drop-shadow(0 8px 10px rgba(0,0,0,0.12));
  }

  @keyframes floatUp {
    to { transform: translateY(-110vh); opacity: 0; }
  }

  /* Confetti dentro la card */
  .confetti {
    position: absolute;
    top: -10px;
    width: 10px;
    height: 14px;
    border-radius: 4px;
    opacity: 0.95;
    animation: confettiFall 1.25s ease-in forwards;
    pointer-events: none;
  }

  @keyframes confettiFall {
    to {
      transform: translateY(260px) rotate(260deg);
      opacity: 0;
    }
  }
</style>
</head>

<body>
  <div class="card" id="card">
    <h1>Ciao Lilian ‚ù§Ô∏è</h1>

    <p>
      Domanda importantissima (e assolutamente non truccata) üòå<br><br>
      Vuoi essere la mia <strong>Valentina di San Valentino?</strong> üíï
    </p>

    <div class="buttons">
      <button id="yesBtn">S√å üíò</button>
      <button id="noBtn">NO üôÑ</button>
    </div>

    <div id="status" class="pill hidden"></div>

    <div id="final" class="hidden">
      <h1>YEEEE ‚ù§Ô∏è</h1>

      <!-- FOTO: se carichi una foto nel repo (es. foto.jpg) cambia src="foto.jpg" -->
      <img
        id="photo"
        class="photo"
        alt="Noi üíñ"
        src="https://images.unsplash.com/photo-1529634806980-85c3dd6d34ac?auto=format&fit=crop&w=1200&q=80"
      />

      <p id="finalText">
        Lo sapevo üòå<br><br>
        Preparati a una serata piena di coccole, risate e amore üíñ
      </p>

      <div class="grid">
        <div class="panel" id="scratchPanel">
          <h3>üéüÔ∏è Gratta e scopri</h3>

          <div class="scratchWrap" id="scratchBox">
            <div class="scratchPrize">
              <!-- üëá Cambia questo testo come vuoi -->
              <div class="big">PREMIO SEGRETO üíò</div>
              <div class="small">
                Hai vinto: una serata bellissima con me + coccole illimitate üòå‚ù§Ô∏è<br>
                (e forse anche una sorpresa‚Ä¶)
              </div>
            </div>

            <canvas id="scratchCanvas"></canvas>
          </div>

          <div class="scratchHint" id="scratchHint">Gratta con il dito per scoprire il premio ‚ú®</div>
        </div>

        <div class="panel">
          <h3>üî• Misuratore di amore</h3>
          <div class="sliderWrap">
            <input id="loveRange" type="range" min="0" max="100" value="50" />
            <div id="loveText" class="result">Direi che siamo gi√† ad un ottimo livello üòå</div>
          </div>
        </div>

        <div class="panel">
          <h3>üòö Timer dei baci</h3>
          <div class="choices" style="justify-content:center;">
            <button class="choiceBtn" id="kissBtn">Bacio +1 üíã</button>
            <button class="choiceBtn" id="resetKissBtn">Reset üòá</button>
          </div>
          <div id="kissResult" class="result">Baci: 0</div>
        </div>
      </div>
    </div>
  </div>

  <audio id="music" loop>
    <source src="https://cdn.pixabay.com/audio/2022/10/30/audio_946b6b1c6d.mp3" type="audio/mpeg">
  </audio>

<script>
  const card = document.getElementById("card");
  const yesBtn = document.getElementById("yesBtn");
  const noBtn = document.getElementById("noBtn");
  const finalBox = document.getElementById("final");
  const status = document.getElementById("status");
  const music = document.getElementById("music");

  const loveRange = document.getElementById("loveRange");
  const loveText = document.getElementById("loveText");

  const kissBtn = document.getElementById("kissBtn");
  const resetKissBtn = document.getElementById("resetKissBtn");
  const kissResult = document.getElementById("kissResult");

  const scratchPanel = document.getElementById("scratchPanel");
  const scratchBox = document.getElementById("scratchBox");
  const scratchCanvas = document.getElementById("scratchCanvas");
  const scratchHint = document.getElementById("scratchHint");

  let noCount = 0;
  let heartsStarted = false;
  let kisses = 0;

  // Scratch state
  let isScratching = false;
  let scratchedEnough = false;
  let ctx;

  function vibrate(pattern) {
    try { if (navigator.vibrate) navigator.vibrate(pattern); } catch (_) {}
  }

  function showStatus(msg) {
    status.textContent = msg;
    status.classList.remove("hidden");
  }

  function moveNoButton() {
    const container = document.querySelector(".buttons");
    const c = container.getBoundingClientRect();
    const b = noBtn.getBoundingClientRect();

    const padding = 8;
    const maxLeft = c.width - b.width - padding * 2;
    const maxTop  = c.height - b.height - padding * 2;

    const left = padding + Math.random() * Math.max(10, maxLeft);
    const top  = padding + Math.random() * Math.max(10, maxTop);

    noBtn.style.left = left + "px";
    noBtn.style.top  = top + "px";
    noBtn.style.transform = "none";
  }

  function startHearts() {
    if (heartsStarted) return;
    heartsStarted = true;

    setInterval(() => {
      const heart = document.createElement("div");
      heart.className = "heart";
      heart.textContent = ["‚ù§Ô∏è","üíñ","üíï","üíó","üíò"][Math.floor(Math.random()*5)];
      heart.style.left = (Math.random() * 100) + "vw";
      heart.style.fontSize = (Math.random() * 22 + 14) + "px";
      document.body.appendChild(heart);
      setTimeout(() => heart.remove(), 4200);
    }, 260);
  }

  function doYesFlow() {
    finalBox.classList.remove("hidden");
    showStatus("Ok. Questa √® la scelta giusta üòåüíò");
    vibrate([40, 30, 40]);

    music.volume = 0.35;
    music.play().catch(() => {});

    startHearts();
    initScratch();

    yesBtn.disabled = true;
    noBtn.disabled = true;
  }

  // Slider: fill
  function paintLoveRange(){
    const v = Number(loveRange.value);
    loveRange.style.background =
      `linear-gradient(90deg, #ff4d6d ${v}%, rgba(255, 77, 109, 0.22) ${v}%)`;
  }

  function updateLoveText(v) {
    if (v < 20) return "Ok‚Ä¶ timida. Ma ti recupero a colpi di coccole üòå";
    if (v < 40) return "Stai iniziando a convincerti‚Ä¶ bravissima üòè";
    if (v < 60) return "Direi che siamo gi√† ad un ottimo livello üòå";
    if (v < 80) return "Wow. Qui siamo pericolosamente innamorati üíï";
    return "Allarme: livello amore massimo. Procedo con baci immediati üíò";
  }

  paintLoveRange();
  loveText.textContent = updateLoveText(Number(loveRange.value));

  loveRange.addEventListener("input", () => {
    loveText.textContent = updateLoveText(Number(loveRange.value));
    paintLoveRange();
  });

  // S√å
  yesBtn.addEventListener("click", doYesFlow);

  // NO: 5 click
  noBtn.addEventListener("click", () => {
    noCount++;
    vibrate(25);

    if (noCount < 5) {
      const left = 5 - noCount;
      showStatus(`No? Sei sicura? üòè (mancano ${left})`);
      moveNoButton();
      const texts = ["NO üôÑ", "NO? ü§®", "Ancora NO? üòå", "Dai su üòè", "Ok basta üò≥"];
      noBtn.textContent = texts[Math.min(noCount, texts.length - 1)];
    } else {
      showStatus("Ok ok‚Ä¶ mi arrendo. Hai vinto tu üî•‚ù§Ô∏è");
      noBtn.textContent = "Ok‚Ä¶ S√å ‚ù§Ô∏è";
      noBtn.style.background = "#ff4d6d";
      noBtn.style.color = "white";
      noBtn.onclick = () => doYesFlow();
      vibrate([60, 40, 60]);
    }
  });

  // Timer baci
  function kissMessage(k) {
    if (k < 10) return `Baci: ${k} (stai scaldando l‚Äôatmosfera üòè)`;
    if (k < 20) return `Baci: ${k} (ok Lilian‚Ä¶ qui √® serio üíò)`;
    if (k < 30) return `Baci: ${k} (allarme: rischio coccole infinite ü•π)`;
    return `Baci: ${k} ‚úÖ Sbloccato: "Ti porto io via, e basta." ‚ù§Ô∏è`;
  }

  kissBtn.addEventListener("click", () => {
    kisses++;
    vibrate(15);
    kissResult.textContent = kissMessage(kisses);
  });

  resetKissBtn.addEventListener("click", () => {
    kisses = 0;
    kissResult.textContent = "Baci: 0";
  });

  /* ---------- CONFETTI ---------- */
  function launchConfetti() {
    // confetti leggeri dentro la card
    const colors = ["#ff4d6d", "#ff9a9e", "#ffd2dc", "#ffbe5a", "#ffffff"];
    const count = 26;

    for (let i = 0; i < count; i++) {
      const c = document.createElement("div");
      c.className = "confetti";
      c.style.left = (Math.random() * 92 + 4) + "%";
      c.style.background = colors[Math.floor(Math.random() * colors.length)];
      c.style.transform = `rotate(${Math.random() * 180}deg)`;
      c.style.animationDuration = (0.9 + Math.random() * 0.8) + "s";
      c.style.width = (8 + Math.random() * 6) + "px";
      c.style.height = (10 + Math.random() * 8) + "px";
      card.appendChild(c);

      setTimeout(() => c.remove(), 1600);
    }
  }

  /* -------- GRATTA E SCOPRI -------- */
  function resizeCanvasToBox() {
    const rect = scratchBox.getBoundingClientRect();
    const ratio = Math.max(1, Math.floor(window.devicePixelRatio || 1));

    scratchCanvas.width = Math.floor(rect.width * ratio);
    scratchCanvas.height = Math.floor(rect.height * ratio);
    scratchCanvas.style.width = rect.width + "px";
    scratchCanvas.style.height = rect.height + "px";

    ctx = scratchCanvas.getContext("2d");
    ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
  }

  function drawCover() {
    if (!ctx) return;
    const rect = scratchBox.getBoundingClientRect();

    const g = ctx.createLinearGradient(0, 0, rect.width, rect.height);
    g.addColorStop(0, "#ffb3c1");
    g.addColorStop(0.5, "#ff4d6d");
    g.addColorStop(1, "#ff9a9e");

    ctx.globalCompositeOperation = "source-over";
    ctx.fillStyle = g;
    ctx.fillRect(0, 0, rect.width, rect.height);

    for (let i = 0; i < 80; i++) {
      ctx.fillStyle = `rgba(255,255,255,${Math.random() * 0.25})`;
      ctx.beginPath();
      ctx.arc(Math.random() * rect.width, Math.random() * rect.height, Math.random() * 2 + 0.5, 0, Math.PI * 2);
      ctx.fill();
    }

    ctx.fillStyle = "rgba(255,255,255,0.95)";
    ctx.font = "700 18px Arial";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText("GRATTA QUI ‚ú®", rect.width / 2, rect.height / 2);
  }

  function scratchAt(clientX, clientY) {
    if (!ctx || scratchedEnough) return;

    const rect = scratchCanvas.getBoundingClientRect();
    const x = clientX - rect.left;
    const y = clientY - rect.top;

    ctx.globalCompositeOperation = "destination-out";
    ctx.beginPath();
    ctx.arc(x, y, 18, 0, Math.PI * 2);
    ctx.fill();

    checkScratchProgress();
  }

  let lastCheck = 0;
  function checkScratchProgress() {
    const now = Date.now();
    if (now - lastCheck < 350) return;
    lastCheck = now;

    const rect = scratchBox.getBoundingClientRect();
    const w = Math.floor(rect.width);
    const h = Math.floor(rect.height);

    const img = ctx.getImageData(0, 0, w, h).data;
    let transparent = 0;
    const total = img.length / 4;

    for (let i = 3; i < img.length; i += 4) {
      if (img[i] === 0) transparent++;
    }

    const pct = transparent / total;
    if (pct > 0.45 && !scratchedEnough) {
      scratchedEnough = true;
      scratchHint.textContent = "Premio sbloccato üòèüíò";
      vibrate([30, 30, 30]);

      // pulisci cover
      ctx.clearRect(0, 0, w, h);

      // üéâ confetti
      launchConfetti();
    }
  }

  function initScratch() {
    if (ctx) return;

    resizeCanvasToBox();
    drawCover();

    const onDown = (e) => {
      isScratching = true;
      const p = getPoint(e);
      scratchAt(p.x, p.y);
      vibrate(10);
    };

    const onMove = (e) => {
      if (!isScratching) return;
      e.preventDefault();
      const p = getPoint(e);
      scratchAt(p.x, p.y);
    };

    const onUp = () => { isScratching = false; };

    scratchCanvas.addEventListener("pointerdown", onDown);
    scratchCanvas.addEventListener("pointermove", onMove);
    window.addEventListener("pointerup", onUp);

    window.addEventListener("resize", () => {
      const already = scratchedEnough;
      ctx = null;
      resizeCanvasToBox();
      if (!already) drawCover();
    }, { passive: true });
  }

  function getPoint(e) {
    if (e.touches && e.touches[0]) {
      return { x: e.touches[0].clientX, y: e.touches[0].clientY };
    }
    return { x: e.clientX, y: e.clientY };
  }
</script>

</body>
</html>
